<div class ="homesearch">

  <%= form_tag plans_path, method: :get, authentication: false, id: 'search-form' do %>
    <div id="step1">
      <div class="scity">
        <div class="header1">
          <center><b>City</b> search</center>
        </div>
          <div id='city-search' class="small-3 small-centered columns">
            <center><%= text_field_tag :city, params[:city] %>
            <input name="next" id="button1"class="button [tiny small large]" type="button" value="Next" />
            </center>
          </div>  
      </div> 
    </div>

  <div id="step2">
    <div class="sform">
      <div class="header2">
        <center>Search for <b>Plans</b></center>
      </div>
        <div class="formgrid">
          <%= render partial: "form" %>
          
        </div>
        
      </div>
    </div>

<!-- Code Continues down here -->

   <!--  <div id="step3">
      <div class="scity">
          <div class="small-3 small-centered columns">
        How Many <b>Minutes</b>?
        <%= number_field_tag :minute, params[:minute] %>
          </div>

          <div class="btnlayout">
        <input name="back" id="buttonback3"class="button" type="button" value="Back" />
        <input name="next" id="button3"class="button" type="button" value="Next" />
          </div>
      </div>
    </div>

     <div id="step4">
      <div class="scity">
        <div class="small-3 small-centered columns">
        How Much <b>Data</b>?
        <%= number_field_tag :data, params[:data] %>
        </div>

        <div class="btnlayout">
        <input name="back" id="buttonback4"class="button" type="button" value="Back" />
        <input name="next" id="button4"class="button" type="button" value="Next" />
        </div>
      </div>
    </div>

     <div id="step5">
      <div class="scity">
        <div class="small-3 small-centered columns">
        How Many <b>Texts</b>?
        <%= number_field_tag :text, params[:text] %>
        </div>
          <div class="btnlayout">
        <input name="back" id="buttonback5"class="button" type="button" value="Back" />
        <%= submit_tag "Search", :name => nil, class: 'button' %>
        </div>
      </div>
    </div>
     -->

  <% end %>

</div>

   <div class="searchrow">
<div class ="row">
    <div class="searches">
      <center><b>Recent</b> searches</center>
    </div>
 
    <div id="search-display"></div>
</div>  
</div>

<script>
  // When firebase database gets added to, it will update root with what was added
  var url = "https://sizzling-fire-5831.firebaseio.com";
  var firebaseRef = new Firebase(url).limit(5);
  firebaseRef.on('child_added', function(snapshot) {
  	var search = snapshot.val();
    displayChatMessage(search.Price, search.Minute, search.Data, search.Text);
  	});
  function displayChatMessage(price, minute, data, text) {

    var div = $("<div class='realTimeSearch medium-2 columns'/>");
    // Fills the div with information
    $("<p class=displayPrice >").text(price).prepend($('<em/>').text("$ ")).appendTo(div);
    $("<p class=displayMinute >").text(minute).prepend($('<em/>').text("Minutes: ")).appendTo(div);
    $("<p class=displayData >").text(data).prepend($('<em/>').text("Data: ")).appendTo(div);
    $("<p class=displayText >").text(text).prepend($('<em/>').text("Text: ")).appendTo(div);
    // Appends the information to the home page
    $('#search-display').prepend(div);
    $('#search-display')[0].scrollTop = $('#search-display')[0].scrollHeight;
  };

  // Autofill typeahead
  var substringMatcher = function(strs) {
    return function findMatches(q, cb) {
      var matches, substringRegex;

      // an array that will be populated with substring matches
      matches = [];

      // regex used to determine if a string contains the substring 'q'
      substrRegex = new RegExp(q, 'i');

      // iterate through the pool of strings and for any string that
      // contains the substring 'q', add it to the 'matches' array
      $.each(strs, function(i, str) {
        if (substrRegex.test(str)) {
          matches.push({ value: str});
        }
      })

      cb(matches);
    };
  };
  

  var cities = <%= raw @cities %>
  
  
  $('#city-search #city').typeahead({
    hint: true,
    highlight: true,
    minLength: 3,
  },
  {
    name: 'cities',
    displayKey: 'value',
    source: substringMatcher(cities)

  }); 

</script>

<div class="scity">
    <div class="header1">
      <center><h3>How It Works</h3></center>
    </div>
  </div>
